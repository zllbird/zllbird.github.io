<!DOCTYPE HTML>

<html lang="en-us">

<head>
	<meta charset="utf-8">
	<title>Android自定义属性使用 - Coder-bird</title>
	<meta name="author" content="map[name:诸隆隆]">

	
	
	<meta name="description" content="">
	

	
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    
	<link rel="canonical" href="https://zllbird.github.io/2015/11/23/android%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B1%9E%E6%80%A7%E4%BD%BF%E7%94%A8/">
	<link href="https://zllbird.github.io//favicon.png" rel="shortcut icon">
	<link href="https://zllbird.github.io//css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="https://zllbird.github.io//css/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	
	<link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	
	
	
</div>

<nav id="main-nav"><ul class="main">
    <li><a href="/">Blog</a></li>
    <li><a href="http://about.me/shashankmehta">About</a></li>
    <li><a href="/post/">Archives</a></li>
</ul>

<section class="aboutme">
  <p>
    我是一只小小鸟
  </p>
</section>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		
			<a class="facebook" href='http://www.facebook.com/%e8%af%b8%e9%9a%86%e9%9a%86' title="Facebook">Facebook</a>
		
		
		
			<a class="twitter" href='http://twitter.com/%e8%af%b8%e9%9a%86%e9%9a%86' title="Twitter">Twitter</a>
		
		
			<a class="github" href='https://github.com/zllbird' title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		
		
		
    	
    	
	</div>
</nav>
</header>
			</div>
		</div>
		<div class="mid-col">
			
			<div class="mid-col-container">
				<div id="content" class="inner">
					<div itemscope itemtype="http://schema.org/Blog">
					<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <h1 class="title" itemprop="name">Android自定义属性使用</h1>
	<div class="entry-content" itemprop="articleBody">

<h1 id="android自定义属性使用以及注意事项:3bdf756234a6e48d25bbfd7dc8dacd4b">Android自定义属性使用以及注意事项</h1>

<p>自定义控件和自定义属性是安卓开发过程中实现个性化的一个很好技巧，也是对sdk中UI部分的使用更加灵活的部分。这部分主要实现自定义属性，自定义控件的文档正在完善中。</p>

<h3 id="如何实现:3bdf756234a6e48d25bbfd7dc8dacd4b">如何实现：</h3>

<h4 id="a-在配置文件中声明:3bdf756234a6e48d25bbfd7dc8dacd4b">a) 在配置文件中声明。</h4>

<p>虽说在value中哪个文件里都是一样（保证在resources标签下就行)，但作为一个有志向的开发者，良好的文件管理习惯是必须的，so，在values中创建一个名为：<code>attrs.xml</code>来统一管理自定义属性。</p>

<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;resources&gt;
  &lt;declare-styleable name=&quot;ImageTextView&quot;&gt;
        &lt;attr name=&quot;select_src&quot; format=&quot;reference&quot; /&gt;
        &lt;attr name=&quot;normal_src&quot; format=&quot;reference&quot; /&gt;
        &lt;attr name=&quot;select_text_color&quot; format=&quot;color&quot; /&gt;
        &lt;attr name=&quot;normal_text_color&quot; format=&quot;color&quot; /&gt;
        &lt;attr name=&quot;image_text_padding&quot; format=&quot;dimension&quot;/&gt;
        &lt;attr name=&quot;android:textSize&quot;/&gt;
        &lt;attr name=&quot;android:layout_gravity&quot; /&gt;
        &lt;attr name=&quot;android:text&quot; /&gt;
    &lt;/declare-styleable&gt;
&lt;/resources&gt;
</code></pre>

<p>自定义属性的声明是通过子标签<code>declare-styleable</code>声明了大的样式，具体的属性是通过<code>attr</code>来声明，声明包含属性名和格式（具体是属性值的格式，一般有reference，color，integer，float，dimension，boolean，string等，当然还有enum，如果是枚举的话要继续声明具体的枚举），如果对于自定义控件来说，某些属性就是已经android声明的属性，就可以在<code>name</code>后面直接写明使用android：声明的哪个属性（简单吧）。</p>

<h4 id="b-在自定义控件xml中使用:3bdf756234a6e48d25bbfd7dc8dacd4b">b) 在自定义控件xml中使用</h4>

<p>（主要是讲解自定义属性，所以这里的自定义控件较为简单，就是一个imageview + textview的组合）</p>

<pre><code class="language-xml">&lt;com.android.lesdo.view.UpImageTextView
	//声明使用app来定义自定义属性名，当然这个命名是你确定的。
    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;
    android:id=&quot;@+id/iv&quot;
    android:layout_width=&quot;wrap_content&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:text = &quot;Hello&quot;
    android:textSize = &quot;14sp&quot;
    android:layout_marginRight=&quot;59dp&quot;
    // 使用刚才已经在arrts里声明好的属性
    app:select_src = &quot;@drawable/searchuser_t_pressed&quot; 
    app:normal_src = &quot;@drawable/searchuser_t_normal&quot;
    app:select_text_color = &quot;@color/green&quot;
    app:normal_text_color = &quot;@color/content&quot;
    app:image_text_padding = &quot;7dp&quot;
    /&gt;
</code></pre>

<p>当然，你也可以声明android本来的属性，一样可以使用（具体在自定义控件里说明）。</p>

<h4 id="c-在自定义控件-java类-中读取属性使用:3bdf756234a6e48d25bbfd7dc8dacd4b">c) 在自定义控件（java类）中读取属性使用</h4>

<p>最后的使用。</p>

<p>自定义控件大多数要继承原本的<code>Imageview</code> ，<code>TextView</code> ，<code>FrameLayout</code>等，当然直接继承View也是一样的，只不过直接继承View和ViewGroup的灵活性太高，一般用不到。</p>

<pre><code class="language-java">public UpImageTextView(Context context, AttributeSet attrs, int defStyleAttr) {
    super(context, attrs, defStyleAttr);
    // 加载布局文件
    LayoutInflater.from(context).inflate(R.layout.down_text_image,this);
        imageView = (ImageView) findViewById(R.id.image);
        textView = (TextView) findViewById(R.id.text);

    // 获取属性集
  	// 这里获取的就是我们再res 下value中声明的ImageTextView属性集
  	// 当然是由IDE自动在R文件中生成的。
        final TypedArray a = context.obtainStyledAttributes(
                attrs, R.styleable.ImageTextView);

    // 通过声明的format 就可以定向获取到属性
  	// R.styleable 都是自动生成的，具体属性名都是跟在声明的style名字后面的
  	// R.styleable.ImageTextView_normal_src对应的就是 arrts.xml中的
  	// &lt;attr name=&quot;normal_src&quot; format=&quot;reference&quot; /&gt;

       int selectRes = a.getResourceId(R.styleable.ImageTextView_select_src,0);
       int normalRes = a.getResourceId(R.styleable.ImageTextView_normal_src,0);
       int selectTextColor = a.getResourceId(R.styleable.ImageTextView_select_text_color,R.color.green);
       int normalTextColor = a.getResourceId(R.styleable.ImageTextView_normal_text_color, R.color.title);
      int textSize = a.getDimensionPixelSize(R.styleable.ImageTextView_android_textSize, 0);
        int image_text_padding = a.getDimensionPixelOffset(R.styleable.ImageTextView_image_text_padding,0);
        String text = a.getString(R.styleable.ImageTextView_android_text);

        a.recycle();
        imageView.setImageResource(normalRes);
        textView.setTextColor(getResources().getColor(normalTextColor));
        textView.setTextSize(TypedValue.COMPLEX_UNIT_PX, textSize);
        textView.setText(text);
        textView.setPadding(0,image_text_padding,0,0);
}
</code></pre>

<p>依次获取属性，然后使用。弹药注意的是，获取完自定义或者本身的属性后，一定要将<code>final TypedArray a</code>返回到用之前的状态，可以看到<code>TypedArray</code>是context中获取的，它是一个环境中统一使用的，所以用完记得要还。</p>

<pre><code class="language-java"> a.recycle();
</code></pre>

<p>注意的坑：</p>

<pre><code class="language-java"> int textSize = a.getDimensionPixelSize(R.styleable.ImageTextView_android_textSize, 0);
</code></pre>

<p>这里获取的 ，单位是<strong>sp</strong>得值 ，单位是<strong>sp</strong>得值 ，单位是<strong>sp</strong>得值！！！</p>

<p>所以使用的时候记得加上<code>TypedValue</code>。</p>

<pre><code class="language-java">textView.setTextSize(TypedValue.COMPLEX_UNIT_PX, textSize);
</code></pre>
</div></article>
					
						<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	
	
	</div>
	
</div>

					
					
					


				    </div>
				</div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2015

    诸隆隆

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a>
<script src="https://zllbird.github.io//js/slash.js"></script>
<script src="https://zllbird.github.io//js/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script></footer>
		</div>
	</div>
	
</body>
</html>
